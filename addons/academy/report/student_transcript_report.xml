<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="action_report_student_transcript" model="ir.actions.report">
        <field name="name">Student Transcript</field>
        <field name="model">res.partner</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">academy.report_student_transcript_template</field>
        <field name="report_file">academy.report_student_transcript_template</field>
        <field name="print_report_name">'Student Transcript - %s' % (object.name)</field>
        <field name="binding_model_id" ref="base.model_res_partner"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_student_transcript_template">
        <t t-call="web.html_container">
            <t t-foreach="partner_data" t-as="data">
                <t t-call="academy.report_student_transcript_content"/>
            </t>
        </t>
    </template>

    <template id="report_student_transcript_content">
        <t t-call="web.external_layout">
            <div class="page">
                <!-- Report Header -->
                <div class="text-center mb-4">
                    <h1>Student Transcript</h1>
                    <p class="text-muted">
                        Generated on:
                        <span t-out="report_date" t-options='{"widget": "datetime"}'/>
                    </p>
                </div>

                <!-- Student Info (from data['partner']) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h2><span t-out="data['partner'].name"/></h2>
                        <p>
                            <span t-if="data['partner'].email" t-out="data['partner'].email"/>
                            <span t-if="data['partner'].phone"> | <span t-out="data['partner'].phone"/></span>
                        </p>
                    </div>
                </div>

                <!-- Statistics Cards (from our Python calculations) -->
                <div class="row mb-4">
                    <div class="col-6">
                        <div class="card">
                            <div class="card-body text-center">
                                <h3 class="text-primary" t-out="data['total_courses']"/>
                                <p>Total Courses</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card">
                            <div class="card-body text-center">
                                <h3 class="text-success">
                                    <span t-out="round(data['average_grade'], 2)"/>
                                </h3>
                                <p>Average Grade</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top 3 Courses Table (from our Python calculations) -->
                <h3>Top 3 Courses</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Course</th>
                            <th class="text-end">Grade</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="data['top_courses']" t-as="course">
                            <tr>
                                <td><span t-out="course_index + 1"/></td>
                                <td><span t-out="course['course_name']"/></td>
                                <td class="text-end">
                                    <span t-out="round(course['grade'], 2)"/>
                                </td>
                            </tr>
                        </t>
                        <tr t-if="not data['top_courses']">
                            <td colspan="3" class="text-center text-muted">
                                No courses completed yet
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- All Enrollments Table -->
                <h3 class="mt-4">All Course Enrollments</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Course</th>
                            <th class="text-end">Grade</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="data['enrollments']" t-as="enrollment">
                            <tr>
                                <td><span t-out="enrollment_index + 1"/></td>
                                <td><span t-field="enrollment.course_id"/></td>
                                <td class="text-end">
                                    <span t-field="enrollment.grade"/>
                                </td>
                                <td>
                                    <span t-if="enrollment.state" 
                                          t-field="enrollment.state" 
                                          class="badge bg-info"/>
                                </td>
                            </tr>
                        </t>
                        <tr t-if="not data['enrollments']">
                            <td colspan="4" class="text-center text-muted">
                                No enrollments found
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </t>
    </template>

</odoo>